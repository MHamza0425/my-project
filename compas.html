<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compass — All Tools Hub</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background: #f5f5f5;
      color: #333;
      text-align: center;
    }
    header, footer {
      background: #222;
      color: #fff;
      padding: 1rem;
    }
    header a {
      color: #4da6ff;
      text-decoration: none;
      font-weight: bold;
      font-size: 1.2rem;
    }
    .container { padding: 2rem; }
    .dial {
      width: 250px; height: 250px;
      border: 6px solid #666;
      border-radius: 50%;
      margin: 1rem auto;
      position: relative;
      background: #fff;
    }
    .needle {
      width: 6px; height: 100px;
      background: red;
      position: absolute;
      top: 25px; left: 50%;
      transform-origin: bottom;
      transform: rotate(0deg);
      transition: transform 0.3s ease;
    }
    .north {
      position: absolute;
      top: 5px; left: 50%;
      transform: translateX(-50%);
      font-weight: bold;
    }
    .controls { margin-top: 1.5rem; }
    select, button {
      padding: 0.5rem;
      margin: 0.3rem;
    }
  </style>
</head>
<body>

<header>
  <a href="/">All Tools Hub</a>
</header>

<div class="container">
  <h1>Compass Tool</h1>
  <div id="dial" class="dial">
    <div class="needle" id="needle"></div>
    <div class="north">N</div>
  </div>
  <div>
    <p id="direction">Direction: N</p>
    <p id="degrees">0°</p>
  </div>

  <div class="controls">
    <label>Needle Style:
      <select id="needleStyle">
        <option value="red">Classic Red</option>
        <option value="blue">Modern Blue</option>
        <option value="cyan">Neon Cyan</option>
      </select>
    </label>
    <label>Dial Theme:
      <select id="dialTheme">
        <option value="light">Light</option>
        <option value="dark">Dark</option>
        <option value="wood">Wood</option>
        <option value="metal">Metal</option>
      </select>
    </label>
  </div>

  <div class="controls">
    <button onclick="copyReading()">Copy</button>
    <button onclick="downloadReading('txt')">Download TXT</button>
    <button onclick="downloadReading('csv')">Download CSV</button>
    <button onclick="downloadReading('json')">Download JSON</button>
  </div>
</div>

<footer>
  Contact: <a href="mailto:saadkhan0425@gmail.com">saadkhan0425@gmail.com</a>
</footer>

<script>
const needle = document.getElementById("needle");
const dirText = document.getElementById("direction");
const degText = document.getElementById("degrees");

function setHeading(deg) {
  const d = (deg + 360) % 360;
  needle.style.transform = rotate(${d}deg);
  degText.textContent = d.toFixed(0) + "°";
  dirText.textContent = "Direction: " + degToCardinal(d);
}

function degToCardinal(deg) {
  const dirs = ["N","NE","E","SE","S","SW","W","NW"];
  return dirs[Math.round(deg/45)%8];
}

// Use DeviceOrientation API if available
if (window.DeviceOrientationEvent) {
  if (typeof DeviceOrientationEvent.requestPermission === "function") {
    // iOS requires permission
    document.body.addEventListener("click", () => {
      DeviceOrientationEvent.requestPermission().then(response => {
        if (response === "granted") {
          window.addEventListener("deviceorientation", handleOrientation);
        } else {
          alert("Permission denied for compass sensor.");
        }
      });
    }, { once: true });
  } else {
    // Android
    window.addEventListener("deviceorientationabsolute", handleOrientation);
    window.addEventListener("deviceorientation", handleOrientation);
  }
} else {
  // fallback: simulated rotation
  let angle = 0;
  setInterval(()=>{ angle=(angle+5)%360; setHeading(angle); },1000);
}

function handleOrientation(event) {
  let heading;
  if (event.webkitCompassHeading) {
    heading = event.webkitCompassHeading; // iOS
  } else {
    heading = event.alpha; // Android
    if (typeof event.absolute !== "undefined" && !event.absolute) {
      heading = 360 - heading; // adjust
    }
  }
  if (heading != null) setHeading(heading);
}

// Needle style selector
document.getElementById("needleStyle").addEventListener("change", e=>{
  needle.style.background = e.target.value;
});

// Dial theme selector
document.getElementById("dialTheme").addEventListener("change", e=>{
  const dial = document.getElementById("dial");
  const theme = e.target.value;
  if(theme==="light") dial.style.background="#fff";
  if(theme==="dark") dial.style.background="#222";
  if(theme==="wood") dial.style.background="saddlebrown";
  if(theme==="metal") dial.style.background="silver";
});

// Copy
function copyReading(){
  const text = dirText.textContent+" "+degText.textContent;
  navigator.clipboard.writeText(text);
  alert("Copied: "+text);
}

// Download
function downloadReading(type){
  const data = { direction: dirText.textContent, degrees: degText.textContent };
  let blob;
  if(type==="txt"){ blob=new Blob([JSON.stringify(data)],{type:"text/plain"}); }
  if(type==="csv"){ blob=new Blob([direction,degrees\n${data.direction},${data.degrees}],{type:"text/csv"}); }
  if(type==="json"){ blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"}); }
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="compass."+type;
  a.click();
}
</script>

</body>
</html>
